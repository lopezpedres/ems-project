"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPage = void 0;
const utils_1 = require("../shared/utils");
const assert_1 = require("../shared/utils/assert");
const releasePageContext_1 = require("./releasePageContext");
const loadPageFiles_1 = require("./loadPageFiles");
const getPageContextSerializedInHtml_1 = require("./getPageContextSerializedInHtml");
const urlPathnameOriginal = (0, utils_1.getUrlPathname)();
async function getPage() {
    let pageContext = (0, getPageContextSerializedInHtml_1.getPageContextSerializedInHtml)();
    (0, utils_1.objectAssign)(pageContext, { isHydration: true });
    const pageFiles = await (0, loadPageFiles_1.loadPageFiles)(pageContext);
    (0, utils_1.objectAssign)(pageContext, pageFiles);
    assertPristineUrl();
    const pageContextProxy = (0, releasePageContext_1.releasePageContext)(pageContext);
    (0, utils_1.checkType)(pageContextProxy);
    return pageContextProxy;
}
exports.getPage = getPage;
function assertPristineUrl() {
    const urlPathnameCurrent = (0, utils_1.getUrlPathname)();
    (0, assert_1.assertWarning)(urlPathnameOriginal === urlPathnameCurrent, `\`getPage()\` returned page information for URL \`${urlPathnameOriginal}\` instead of \`${urlPathnameCurrent}\`. If you want to be able to change the URL (e.g. with \`window.history.pushState\`) while using \`getPage()\`, then create a new GitHub issue.`);
}
//# sourceMappingURL=getPage.js.map